/* fork.js 0.0.1 
 Copyright (c) 2013 Allen Heavey
*/!function(a){"use strict";function b(){}function c(a){var b={};for(var c in a)b[c]=a[c];return b}function d(b){var c=b;if(c){for(var d in a)c[d]?delete c[d]:delete a[d];for(var e in c)a[e]=c[e]}}function e(a){var b="http://"===a.substring(0,6),c="file://"===a.substring(0,6);return b||c}function f(a){return"/"===a.charAt(0)}function g(a){var b=/[^?#]*\//;return a.match(b)[0]}function h(a){var b=a.slice(-3);return".js"!==b&&(a+=".js"),a}function i(a,b,c){var d;if(c)if("r"===c)for(d=g(b)+a;d.match(F);)d=d.replace(F,"/");else"a"===c&&(d=b?g(b)+a:y+a);else d=b+a;return d}function j(a,b){if(f(a))return a;var c,d=a.charAt(0),e=d+a.charAt(1);return"."===d?"./"===e?c=b+a.substring(2):".."===e&&(c=i(a,b,"r")):"/"===d&&(c=i(a,b,"a")),c}function k(a,b){if(!a)throw new Error("You should require something.");return e(a)?a:(b||(b=w),a=h(a),j(a,b))}function l(b,d){var e=document.createElement("script");d.status<A.LOADING&&(d.status=A.LOADING),a.module=d,a.exports=d.exports,a.require=d.require;var f=c(a);return a.global=f,D=setInterval(function(){m(e,f,d)},10),d.status<A.LOADED&&m(e,f,d),d.status=A.LOADED,e.async=!0,e.src=b,C=e,G.appendChild(e),C=null,d}function m(a,b,c){a.onload=a.onerror=a.onreadystatechange=function(){console.log("module.execute..."+(new Date).getTime()),clearInterval(D),H.test(a.readyState)&&(a.onload=a.onerror=a.onreadystatechange=null,c.status=A.EXECUTING,G.removeChild(a),a=null,d(b))}}function n(a){this.uri=a,this.exports={},this.status=0}function o(){console.log(t),n.get(t)}var p={version:"0.0.1"},q=location,r={};r.pwd=g(q.href);var s=document.getElementById("forkjs"),t=s.getAttribute("data-main"),u=s.src||s.getAttribute("src",4),v=g(u),w=r.cwd=v,x=/^.*\w+\.\w+\//,y=v.match(x)?v.match(x)[0]:"",z={};z.isBoolean=function(a){return"boolean"==typeof a},z.isNull=function(a){return null===a},z.isNumber=function(a){return"number"==typeof a},z.isString=function(a){return"string"==typeof a},z.isUndefined=function(a){return void 0===a},z.isObject=function(a){return"object"==typeof a&&null!==a},z.isFunction=function(a){return"function"==typeof a};var A=n.STATUS={FETCHING:1,SAVED:2,LOADING:3,LOADED:4,EXECUTING:5,EXECUTED:6},B=r.events={};p.on=function(a,b){for(var c=B[a]||(B[a]=[]),d=!1,e=0,f=c.length;f>e;e++)c[e]===b&&(d=!0);return d||c.push(b),p},p.addListener=p.on,p.off=function(a,b){if(!a)throw new Error("You should have a name when you remove a listener.");var c=B[a];if(c)if(b){for(var d=c.length;d>=0;d--)if(c[d]===b){c.splice(d,1);break}}else delete B[a];return module.js},p.removeListener=p.off,p.removeAllListener=function(a){a?delete B[a]:(delete r.events,B=r.events={})};var C,D,E=p.emit=function(a){var b,c=B[a],d=Array.prototype.slice.call(arguments,1);if(c)for(c=c.slice();b=c.shift();)b(d)},F=/\/[^/]+\/\.\.\//,G=document.getElementsByTagName("head")[0]||document.documentElement,H=/^(?:loaded|complete|undefined)$/,I=p.cache={},J={},K={};n.resolve=function(a,b){var c={id:a,refUri:b};E("resolve",c);var d=c.uri||k(a,b);return d},n.prototype.resolve=function(){for(var a=this,b=a.dependencies,c=[],d=0,e=b.length;e>d;d++)c[d]=n.resolve(b[d],a.uri);return c},n.prototype.load=function(){var a=this;a.status>=A.LOADING||(a.status=A.LOADING,a.resolve())},n.prototype.onload=function(){var a=this;a.status=A.LOADED,a.callback&&a.callback();var b,c,d=a.waitings;for(b in d)d.hasOwnProperty(b)&&(c=I[b],c.remain-=d[b],0===c.remain&&c.onload());delete a.waitings,delete a.remain},n.prototype.fetch=function(){function a(){l(c,b)}var b=this,c=b.uri;b.status=b.status<A.FETCHING?b.status:A.FETCHING,J[c]=!0,K[c]=[b],b.status<A.LOADING&&(b.status=A.LOADING,a())},n.get=function(a){a=n.resolve(a);var b=I[a]||(I[a]=new n(a));return b.status>=A.EXECUTING?b:(b.status=A.FETCHING,b.fetch(),b)},n.prototype.exec=function(){for(var a,c=this;c.status<A.EXECUTING;)setTimeout(b,0);return c.status>=A.EXECUTING&&(a=c.exports),D&&(clearInterval(D),D=null),a},n.prototype.require=function(a){var b=this,c=b.uri||p.cwd;return n.get(n.resolve(a,c)).exec()},a.hand=o,a.forkjs=p}(window);